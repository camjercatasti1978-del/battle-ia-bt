<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ü§ñ Trading Bot CUSTOM - Indicateurs Personnalisables</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
    <style>
        body {
            background: linear-gradient(135deg, #0f172a 0%, #1e1b4b 100%);
            min-height: 100vh;
            color: white;
        }
        .card {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 20px;
            backdrop-filter: blur(10px);
        }
        .indicator-chip {
            background: rgba(59, 130, 246, 0.2);
            border: 2px solid #3b82f6;
            transition: all 0.3s;
        }
        .indicator-chip.selected {
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
            border-color: #10b981;
            box-shadow: 0 0 20px rgba(16, 185, 129, 0.5);
        }
        .indicator-chip:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(59, 130, 246, 0.3);
        }
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }
        .pulse { animation: pulse 2s ease-in-out infinite; }
        .trade-log {
            max-height: 400px;
            overflow-y: auto;
        }
    </style>
</head>
<body class="p-4 md:p-6">
    <div class="max-w-7xl mx-auto">
        
        <!-- Header -->
        <div class="text-center mb-8">
            <h1 class="text-5xl font-bold bg-gradient-to-r from-blue-400 via-purple-500 to-pink-500 bg-clip-text text-transparent mb-3">
                ü§ñ TRADING BOT PERSONNALISABLE
            </h1>
            <p class="text-gray-300 text-lg">Choisissez VOS indicateurs pour BUY et SELL ‚Ä¢ Test sur 1 an de donn√©es R√âELLES</p>
        </div>

        <!-- Configuration -->
        <div class="card p-6 mb-6">
            <h2 class="text-2xl font-bold mb-4">‚öôÔ∏è Configuration</h2>

            <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-4">
                <div>
                    <label class="block text-sm text-gray-300 mb-2 font-semibold">Crypto</label>
                    <select id="symbolSelect" class="w-full bg-gray-800 border-2 border-gray-600 rounded-lg px-4 py-3 text-white">
                        <option value="BTCUSDT">Bitcoin (BTC/USDT)</option>
                        <option value="ETHUSDT">Ethereum (ETH/USDT)</option>
                        <option value="BNBUSDT">Binance Coin (BNB/USDT)</option>
                        <option value="SOLUSDT">Solana (SOL/USDT)</option>
                        <option value="ADAUSDT">Cardano (ADA/USDT)</option>
                    </select>
                </div>

                <div>
                    <label class="block text-sm text-gray-300 mb-2 font-semibold">P√©riode</label>
                    <select id="periodSelect" class="w-full bg-gray-800 border-2 border-gray-600 rounded-lg px-4 py-3 text-white">
                        <option value="1h-500">~21 jours (1h)</option>
                        <option value="4h-500">~83 jours (4h)</option>
                        <option value="1d-365" selected>1 an (1 jour)</option>
                    </select>
                </div>

                <div>
                    <label class="block text-sm text-gray-300 mb-2 font-semibold">Capital</label>
                    <input type="number" id="capitalInput" value="10000" min="1000" step="1000" class="w-full bg-gray-800 border-2 border-gray-600 rounded-lg px-4 py-3 text-white">
                </div>
            </div>

            <button onclick="loadData()" id="loadBtn" class="w-full px-6 py-4 bg-gradient-to-r from-blue-500 to-purple-500 hover:from-blue-600 hover:to-purple-600 text-white rounded-lg font-bold text-lg">
                üì• Charger Donn√©es du March√©
            </button>

            <div id="loadingStatus" class="text-center py-4 mt-4" style="display: none;">
                <div class="pulse text-blue-400 font-bold text-lg">‚è≥ Chargement...</div>
            </div>
        </div>

        <!-- Indicator Selection -->
        <div id="indicatorSelection" class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-6" style="display: none;">
            <!-- BUY Indicators -->
            <div class="card p-6">
                <h2 class="text-2xl font-bold mb-4 text-green-400">üü¢ INDICATEURS D'ACHAT</h2>
                <p class="text-sm text-gray-400 mb-4">S√©lectionnez les conditions pour d√©clencher un ACHAT (toutes doivent √™tre vraies)</p>
                
                <div class="space-y-3" id="buyIndicators">
                    <!-- Filled by JS -->
                </div>
            </div>

            <!-- SELL Indicators -->
            <div class="card p-6">
                <h2 class="text-2xl font-bold mb-4 text-red-400">üî¥ INDICATEURS DE VENTE</h2>
                <p class="text-sm text-gray-400 mb-4">S√©lectionnez les conditions pour d√©clencher une VENTE (au moins une doit √™tre vraie)</p>
                
                <div class="space-y-3" id="sellIndicators">
                    <!-- Filled by JS -->
                </div>
            </div>
        </div>

        <!-- Strategy Summary -->
        <div id="strategySummary" class="card p-6 mb-6" style="display: none;">
            <h2 class="text-2xl font-bold mb-4">üéØ Votre Strat√©gie Personnalis√©e</h2>
            
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                <div class="bg-green-900 bg-opacity-30 border-2 border-green-500 rounded-lg p-4">
                    <p class="text-green-200 font-bold mb-3">‚úÖ CONDITIONS D'ACHAT (<span id="buyCount">0</span> s√©lectionn√©es)</p>
                    <ul id="buyList" class="text-sm text-green-200 space-y-1">
                        <li class="text-gray-400">Aucune condition s√©lectionn√©e</li>
                    </ul>
                </div>
                
                <div class="bg-red-900 bg-opacity-30 border-2 border-red-500 rounded-lg p-4">
                    <p class="text-red-200 font-bold mb-3">‚ùå CONDITIONS DE VENTE (<span id="sellCount">0</span> s√©lectionn√©es)</p>
                    <ul id="sellList" class="text-sm text-red-200 space-y-1">
                        <li class="text-gray-400">Aucune condition s√©lectionn√©e</li>
                    </ul>
                </div>
            </div>

            <button onclick="runBacktest()" id="backtestBtn" class="w-full mt-6 px-6 py-4 bg-gradient-to-r from-green-500 to-teal-500 hover:from-green-600 hover:to-teal-600 text-white rounded-lg font-bold text-lg" disabled>
                üöÄ Lancer Backtest avec Cette Strat√©gie
            </button>
        </div>

        <!-- Progress -->
        <div id="progressSection" class="card p-6 mb-6" style="display: none;">
            <h2 class="text-2xl font-bold mb-4">‚è±Ô∏è Backtest en cours...</h2>
            
            <div class="mb-4">
                <div class="flex justify-between mb-2">
                    <span class="text-gray-400">Progression</span>
                    <span class="font-bold text-green-400" id="progressPercent">0%</span>
                </div>
                <div class="w-full bg-gray-800 rounded-full h-4">
                    <div id="progressBar" class="bg-gradient-to-r from-green-500 to-teal-500 h-4 rounded-full transition-all" style="width: 0%"></div>
                </div>
            </div>

            <div class="grid grid-cols-2 md:grid-cols-4 gap-3">
                <div class="bg-gray-800 border border-gray-600 rounded-lg p-3">
                    <p class="text-xs text-gray-400">Point</p>
                    <p class="font-bold text-white" id="currentDay">0 / 365</p>
                </div>
                <div class="bg-blue-900 bg-opacity-30 border border-blue-600 rounded-lg p-3">
                    <p class="text-xs text-gray-400">Date</p>
                    <p class="font-bold text-blue-400 text-xs" id="currentDate">-</p>
                </div>
                <div class="bg-green-900 bg-opacity-30 border border-green-600 rounded-lg p-3">
                    <p class="text-xs text-gray-400">Prix</p>
                    <p class="font-bold text-green-400" id="currentPrice">$0</p>
                </div>
                <div class="bg-purple-900 bg-opacity-30 border border-purple-600 rounded-lg p-3">
                    <p class="text-xs text-gray-400">Trades</p>
                    <p class="font-bold text-purple-400" id="totalTrades">0</p>
                </div>
            </div>
        </div>

        <!-- Results -->
        <div id="resultsSection" class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-6" style="display: none;">
            <div class="card p-6">
                <h2 class="text-2xl font-bold mb-4">üèÜ R√©sultats</h2>
                <div class="space-y-4">
                    <div class="bg-gradient-to-r from-green-600 to-teal-600 rounded-lg p-6">
                        <p class="text-sm text-green-100 mb-1">ROI Total</p>
                        <p class="text-4xl font-bold text-white" id="finalROI">0%</p>
                    </div>
                    <div class="grid grid-cols-2 gap-4">
                        <div class="bg-blue-900 bg-opacity-50 rounded-lg p-4">
                            <p class="text-xs text-gray-400 mb-1">Capital initial</p>
                            <p class="text-xl font-bold text-blue-400" id="initialCapital">$10,000</p>
                        </div>
                        <div class="bg-green-900 bg-opacity-50 rounded-lg p-4">
                            <p class="text-xs text-gray-400 mb-1">Capital final</p>
                            <p class="text-xl font-bold text-green-400" id="finalCapital">$10,000</p>
                        </div>
                        <div class="bg-purple-900 bg-opacity-50 rounded-lg p-4">
                            <p class="text-xs text-gray-400 mb-1">Profit/Loss</p>
                            <p class="text-xl font-bold" id="totalProfit">$0</p>
                        </div>
                        <div class="bg-yellow-900 bg-opacity-50 rounded-lg p-4">
                            <p class="text-xs text-gray-400 mb-1">Trades</p>
                            <p class="text-xl font-bold text-yellow-400" id="numTrades">0</p>
                        </div>
                    </div>
                </div>
            </div>

            <div class="card p-6">
                <h2 class="text-2xl font-bold mb-4">üìä Statistiques</h2>
                <div class="space-y-3 text-sm">
                    <div class="flex justify-between">
                        <span class="text-gray-400">Win Rate</span>
                        <span class="font-bold text-green-400" id="winRate">0%</span>
                    </div>
                    <div class="flex justify-between">
                        <span class="text-gray-400">Trades gagnants</span>
                        <span class="font-bold text-green-400" id="winTrades">0</span>
                    </div>
                    <div class="flex justify-between">
                        <span class="text-gray-400">Trades perdants</span>
                        <span class="font-bold text-red-400" id="loseTrades">0</span>
                    </div>
                    <div class="flex justify-between">
                        <span class="text-gray-400">Profit moyen</span>
                        <span class="font-bold text-green-400" id="avgWin">$0</span>
                    </div>
                    <div class="flex justify-between">
                        <span class="text-gray-400">Perte moyenne</span>
                        <span class="font-bold text-red-400" id="avgLoss">$0</span>
                    </div>
                    <div class="flex justify-between">
                        <span class="text-gray-400">Max Drawdown</span>
                        <span class="font-bold text-red-400" id="maxDrawdown">0%</span>
                    </div>
                    <div class="flex justify-between">
                        <span class="text-gray-400">Profit Factor</span>
                        <span class="font-bold text-yellow-400" id="profitFactor">0</span>
                    </div>
                </div>
            </div>
        </div>

        <!-- Charts -->
        <div id="chartsSection" style="display: none;">
            <!-- Price Chart -->
            <div class="card p-6 mb-6">
                <h2 class="text-2xl font-bold mb-4">üìà Graphique des Prix avec Points BUY/SELL</h2>
                <div class="h-96 mb-4">
                    <canvas id="priceChart"></canvas>
                </div>
                <div class="grid grid-cols-2 md:grid-cols-3 gap-3">
                    <div class="bg-green-900 bg-opacity-30 border border-green-500 rounded-lg p-3">
                        <p class="text-xs text-green-300">üü¢ Points d'ACHAT</p>
                        <p class="text-2xl font-bold text-green-400" id="buyPointsCount">0</p>
                    </div>
                    <div class="bg-red-900 bg-opacity-30 border border-red-500 rounded-lg p-3">
                        <p class="text-xs text-red-300">üî¥ Points de VENTE</p>
                        <p class="text-2xl font-bold text-red-400" id="sellPointsCount">0</p>
                    </div>
                    <div class="bg-blue-900 bg-opacity-30 border border-blue-500 rounded-lg p-3">
                        <p class="text-xs text-blue-300">üìä Trades Compl√©t√©s</p>
                        <p class="text-2xl font-bold text-blue-400" id="completedTrades">0</p>
                    </div>
                </div>
            </div>

            <!-- Equity Chart -->
            <div class="card p-6 mb-6">
                <h2 class="text-2xl font-bold mb-4">üí∞ √âvolution du Capital</h2>
                <div class="h-96">
                    <canvas id="equityChart"></canvas>
                </div>
            </div>

            <!-- Indicators Charts -->
            <div class="card p-6 mb-6">
                <h2 class="text-2xl font-bold mb-4">üìä Indicateurs Techniques</h2>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div>
                        <h3 class="text-lg font-semibold mb-2 text-purple-400">RSI (14)</h3>
                        <div class="h-64">
                            <canvas id="rsiChart"></canvas>
                        </div>
                    </div>
                    <div>
                        <h3 class="text-lg font-semibold mb-2 text-blue-400">MACD</h3>
                        <div class="h-64">
                            <canvas id="macdChart"></canvas>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Logs -->
        <div class="card p-6">
            <div class="flex justify-between items-center mb-4">
                <h2 class="text-2xl font-bold">üìã Journal des Trades</h2>
                <button onclick="clearLogs()" class="px-4 py-2 bg-gray-700 hover:bg-gray-600 text-white rounded-lg text-sm">
                    üóëÔ∏è Effacer
                </button>
            </div>
            <div id="tradeLogs" class="trade-log space-y-2">
                <div class="text-center text-gray-500 py-8">Chargez les donn√©es...</div>
            </div>
        </div>
    </div>

    <script>
        // AVAILABLE INDICATORS
        const INDICATORS_CONFIG = {
            buy: [
                { id: 'rsi_oversold', name: 'RSI < 30 (Survente)', category: 'Momentum' },
                { id: 'rsi_35', name: 'RSI < 35', category: 'Momentum' },
                { id: 'rsi_40', name: 'RSI < 40', category: 'Momentum' },
                { id: 'stoch_rsi_low', name: 'Stochastic RSI < 20', category: 'Momentum' },
                { id: 'macd_cross_up', name: 'MACD Cross Haussier', category: 'Tendance' },
                { id: 'macd_positive', name: 'MACD > 0', category: 'Tendance' },
                { id: 'ema_20_50_cross', name: 'EMA 20 > EMA 50', category: 'Tendance' },
                { id: 'price_above_ema50', name: 'Prix > EMA 50', category: 'Tendance' },
                { id: 'price_above_ema200', name: 'Prix > EMA 200', category: 'Tendance' },
                { id: 'bb_lower', name: 'Prix proche BB Lower (-2%)', category: 'Volatilit√©' },
                { id: 'bb_touch_lower', name: 'Prix touche BB Lower', category: 'Volatilit√©' },
                { id: 'adx_strong', name: 'ADX > 25 (Tendance forte)', category: 'Force' },
                { id: 'adx_moderate', name: 'ADX > 20', category: 'Force' },
                { id: 'williams_oversold', name: 'Williams %R < -80', category: 'Momentum' },
                { id: 'cci_oversold', name: 'CCI < -100', category: 'Momentum' },
                { id: 'volume_high', name: 'Volume > Moyenne', category: 'Volume' },
                { id: 'volume_surge', name: 'Volume > 150% Moyenne', category: 'Volume' },
                { id: 'obv_rising', name: 'OBV en hausse', category: 'Volume' }
            ],
            sell: [
                { id: 'take_profit_2', name: 'Take Profit +2%', category: 'Gestion' },
                { id: 'take_profit_3', name: 'Take Profit +3%', category: 'Gestion' },
                { id: 'take_profit_5', name: 'Take Profit +5%', category: 'Gestion' },
                { id: 'stop_loss_1', name: 'Stop Loss -1%', category: 'Gestion' },
                { id: 'stop_loss_2', name: 'Stop Loss -2%', category: 'Gestion' },
                { id: 'stop_loss_3', name: 'Stop Loss -3%', category: 'Gestion' },
                { id: 'trailing_stop', name: 'Trailing Stop -1.5%', category: 'Gestion' },
                { id: 'rsi_overbought', name: 'RSI > 70 (Surachat)', category: 'Momentum' },
                { id: 'rsi_75', name: 'RSI > 75', category: 'Momentum' },
                { id: 'stoch_rsi_high', name: 'Stochastic RSI > 80', category: 'Momentum' },
                { id: 'macd_cross_down', name: 'MACD Cross Baissier', category: 'Tendance' },
                { id: 'macd_negative', name: 'MACD < 0', category: 'Tendance' },
                { id: 'price_below_ema50', name: 'Prix < EMA 50', category: 'Tendance' },
                { id: 'price_below_ema20', name: 'Prix < EMA 20', category: 'Tendance' },
                { id: 'bb_upper', name: 'Prix touche BB Upper', category: 'Volatilit√©' },
                { id: 'williams_overbought', name: 'Williams %R > -20', category: 'Momentum' },
                { id: 'cci_overbought', name: 'CCI > 100', category: 'Momentum' },
                { id: 'volume_low', name: 'Volume < 50% Moyenne', category: 'Volume' }
            ]
        };

        let state = {
            data: [],
            indicators: {},
            capital: 10000,
            selectedBuyIndicators: [],
            selectedSellIndicators: [],
            trades: [],
            equity: [],
            logs: [],
            buySignals: [],
            sellSignals: []
        };

        let charts = {
            price: null,
            equity: null,
            rsi: null,
            macd: null
        };

        // INIT
        window.addEventListener('DOMContentLoaded', () => {
            console.log('ü§ñ CUSTOM TRADING BOT');
            initCharts();
            renderIndicatorSelectors();
        });

        function initCharts() {
            // Price Chart
            const priceCtx = document.getElementById('priceChart').getContext('2d');
            charts.price = new Chart(priceCtx, {
                type: 'line',
                data: {
                    labels: [],
                    datasets: [{
                        label: 'Prix',
                        data: [],
                        borderColor: '#3b82f6',
                        backgroundColor: 'rgba(59, 130, 246, 0.1)',
                        borderWidth: 2,
                        tension: 0.1,
                        fill: false,
                        pointRadius: 0
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: { display: true, labels: { color: 'white' } },
                        tooltip: { mode: 'index', intersect: false }
                    },
                    scales: {
                        x: { grid: { color: 'rgba(255, 255, 255, 0.1)' }, ticks: { color: 'white', maxTicksLimit: 10 } },
                        y: { grid: { color: 'rgba(255, 255, 255, 0.1)' }, ticks: { color: 'white' } }
                    }
                }
            });

            // Equity Chart
            const equityCtx = document.getElementById('equityChart').getContext('2d');
            charts.equity = new Chart(equityCtx, {
                type: 'line',
                data: {
                    labels: [],
                    datasets: [{
                        label: 'Capital ($)',
                        data: [],
                        borderColor: '#10b981',
                        backgroundColor: 'rgba(16, 185, 129, 0.1)',
                        borderWidth: 2,
                        tension: 0.4,
                        fill: true
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: { legend: { display: false }, tooltip: { mode: 'index', intersect: false } },
                    scales: {
                        x: { grid: { color: 'rgba(255, 255, 255, 0.1)' }, ticks: { color: 'white', maxTicksLimit: 10 } },
                        y: { grid: { color: 'rgba(255, 255, 255, 0.1)' }, ticks: { color: 'white' } }
                    }
                }
            });

            // RSI Chart
            const rsiCtx = document.getElementById('rsiChart').getContext('2d');
            charts.rsi = new Chart(rsiCtx, {
                type: 'line',
                data: {
                    labels: [],
                    datasets: [{
                        label: 'RSI',
                        data: [],
                        borderColor: '#a855f7',
                        backgroundColor: 'rgba(168, 85, 247, 0.1)',
                        borderWidth: 2,
                        tension: 0.2,
                        fill: true,
                        pointRadius: 0
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: { legend: { display: false }, tooltip: { mode: 'index', intersect: false } },
                    scales: {
                        x: { grid: { color: 'rgba(255, 255, 255, 0.1)' }, ticks: { color: 'white', maxTicksLimit: 10 } },
                        y: { min: 0, max: 100, grid: { color: 'rgba(255, 255, 255, 0.1)' }, ticks: { color: 'white' } }
                    }
                }
            });

            // MACD Chart
            const macdCtx = document.getElementById('macdChart').getContext('2d');
            charts.macd = new Chart(macdCtx, {
                type: 'bar',
                data: {
                    labels: [],
                    datasets: [{
                        label: 'Histogram',
                        data: [],
                        backgroundColor: 'rgba(59, 130, 246, 0.5)',
                        type: 'bar'
                    }, {
                        label: 'MACD',
                        data: [],
                        borderColor: '#10b981',
                        borderWidth: 2,
                        tension: 0.2,
                        type: 'line',
                        pointRadius: 0
                    }, {
                        label: 'Signal',
                        data: [],
                        borderColor: '#ef4444',
                        borderWidth: 2,
                        tension: 0.2,
                        type: 'line',
                        pointRadius: 0
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: { legend: { display: true, labels: { color: 'white' } }, tooltip: { mode: 'index', intersect: false } },
                    scales: {
                        x: { grid: { color: 'rgba(255, 255, 255, 0.1)' }, ticks: { color: 'white', maxTicksLimit: 10 } },
                        y: { grid: { color: 'rgba(255, 255, 255, 0.1)' }, ticks: { color: 'white' } }
                    }
                }
            });
        }

        function renderIndicatorSelectors() {
            // Group by category
            const buyByCategory = {};
            const sellByCategory = {};
            
            INDICATORS_CONFIG.buy.forEach(ind => {
                if (!buyByCategory[ind.category]) buyByCategory[ind.category] = [];
                buyByCategory[ind.category].push(ind);
            });
            
            INDICATORS_CONFIG.sell.forEach(ind => {
                if (!sellByCategory[ind.category]) sellByCategory[ind.category] = [];
                sellByCategory[ind.category].push(ind);
            });
            
            // Render BUY indicators
            let buyHTML = '';
            Object.entries(buyByCategory).forEach(([category, indicators]) => {
                buyHTML += `
                    <div class="mb-4">
                        <p class="text-xs font-semibold text-gray-400 mb-2">${category}</p>
                        <div class="grid grid-cols-1 gap-2">
                            ${indicators.map(ind => `
                                <div class="indicator-chip rounded-lg p-3 cursor-pointer" id="buy-${ind.id}" onclick="toggleBuyIndicator('${ind.id}')">
                                    <div class="flex items-center justify-between">
                                        <span class="text-sm font-semibold">${ind.name}</span>
                                        <span class="text-2xl" id="check-buy-${ind.id}" style="display: none;">‚úì</span>
                                    </div>
                                </div>
                            `).join('')}
                        </div>
                    </div>
                `;
            });
            document.getElementById('buyIndicators').innerHTML = buyHTML;
            
            // Render SELL indicators
            let sellHTML = '';
            Object.entries(sellByCategory).forEach(([category, indicators]) => {
                sellHTML += `
                    <div class="mb-4">
                        <p class="text-xs font-semibold text-gray-400 mb-2">${category}</p>
                        <div class="grid grid-cols-1 gap-2">
                            ${indicators.map(ind => `
                                <div class="indicator-chip rounded-lg p-3 cursor-pointer" id="sell-${ind.id}" onclick="toggleSellIndicator('${ind.id}')">
                                    <div class="flex items-center justify-between">
                                        <span class="text-sm font-semibold">${ind.name}</span>
                                        <span class="text-2xl" id="check-sell-${ind.id}" style="display: none;">‚úì</span>
                                    </div>
                                </div>
                            `).join('')}
                        </div>
                    </div>
                `;
            });
            document.getElementById('sellIndicators').innerHTML = sellHTML;
        }

        function toggleBuyIndicator(id) {
            const index = state.selectedBuyIndicators.indexOf(id);
            if (index > -1) {
                state.selectedBuyIndicators.splice(index, 1);
                document.getElementById(`buy-${id}`).classList.remove('selected');
                document.getElementById(`check-buy-${id}`).style.display = 'none';
            } else {
                state.selectedBuyIndicators.push(id);
                document.getElementById(`buy-${id}`).classList.add('selected');
                document.getElementById(`check-buy-${id}`).style.display = 'block';
            }
            updateStrategySummary();
        }

        function toggleSellIndicator(id) {
            const index = state.selectedSellIndicators.indexOf(id);
            if (index > -1) {
                state.selectedSellIndicators.splice(index, 1);
                document.getElementById(`sell-${id}`).classList.remove('selected');
                document.getElementById(`check-sell-${id}`).style.display = 'none';
            } else {
                state.selectedSellIndicators.push(id);
                document.getElementById(`sell-${id}`).classList.add('selected');
                document.getElementById(`check-sell-${id}`).style.display = 'block';
            }
            updateStrategySummary();
        }

        function updateStrategySummary() {
            const buyNames = state.selectedBuyIndicators.map(id => 
                INDICATORS_CONFIG.buy.find(i => i.id === id)?.name || id
            );
            const sellNames = state.selectedSellIndicators.map(id => 
                INDICATORS_CONFIG.sell.find(i => i.id === id)?.name || id
            );
            
            document.getElementById('buyCount').textContent = buyNames.length;
            document.getElementById('sellCount').textContent = sellNames.length;
            
            if (buyNames.length > 0) {
                document.getElementById('buyList').innerHTML = buyNames.map(n => `<li>‚Ä¢ ${n}</li>`).join('');
            } else {
                document.getElementById('buyList').innerHTML = '<li class="text-gray-400">Aucune condition s√©lectionn√©e</li>';
            }
            
            if (sellNames.length > 0) {
                document.getElementById('sellList').innerHTML = sellNames.map(n => `<li>‚Ä¢ ${n}</li>`).join('');
            } else {
                document.getElementById('sellList').innerHTML = '<li class="text-gray-400">Aucune condition s√©lectionn√©e</li>';
            }
            
            // Enable backtest button if at least one buy and one sell indicator
            document.getElementById('backtestBtn').disabled = !(buyNames.length > 0 && sellNames.length > 0);
        }

        async function loadData() {
            const symbol = document.getElementById('symbolSelect').value;
            const periodConfig = document.getElementById('periodSelect').value;
            const [interval, limit] = periodConfig.split('-');
            
            state.capital = parseFloat(document.getElementById('capitalInput').value);
            
            document.getElementById('loadingStatus').style.display = 'block';
            document.getElementById('loadBtn').disabled = true;
            
            try {
                addLog('system', 'üì• CHARGEMENT', `${symbol} ${limit} chandeliers...`);
                
                const url = `https://api.binance.com/api/v3/klines?symbol=${symbol}&interval=${interval}&limit=${limit}`;
                const response = await fetch(url);
                
                if (!response.ok) throw new Error(`API Error: ${response.status}`);
                
                const binanceData = await response.json();
                
                state.data = binanceData.map(candle => ({
                    timestamp: candle[0],
                    time: new Date(candle[0]).toLocaleString('fr-FR'),
                    open: parseFloat(candle[1]),
                    high: parseFloat(candle[2]),
                    low: parseFloat(candle[3]),
                    close: parseFloat(candle[4]),
                    volume: parseFloat(candle[5])
                }));
                
                if (state.data.length < 200) {
                    throw new Error(`Pas assez de donn√©es (${state.data.length} < 200)`);
                }
                
                addLog('system', '‚úÖ CHARG√â', `${state.data.length} chandeliers`);
                addLog('system', 'üîç CALCUL', 'Calcul des indicateurs...');
                
                calculateAllIndicators();
                
                document.getElementById('loadingStatus').style.display = 'none';
                document.getElementById('indicatorSelection').style.display = 'grid';
                document.getElementById('strategySummary').style.display = 'block';
                
                addLog('system', '‚úÖ PR√äT', 'S√©lectionnez vos indicateurs');
                
            } catch (error) {
                console.error('Error:', error);
                addLog('system', '‚ùå ERREUR', error.message);
                alert('Erreur: ' + error.message);
                document.getElementById('loadingStatus').style.display = 'none';
                document.getElementById('loadBtn').disabled = false;
            }
        }

        function calculateAllIndicators() {
            const closes = state.data.map(d => d.close);
            const highs = state.data.map(d => d.high);
            const lows = state.data.map(d => d.low);
            const volumes = state.data.map(d => d.volume);
            
            state.indicators = {
                rsi: calculateRSI(closes, 14),
                macd: calculateMACD(closes),
                ema20: calculateEMA(closes, 20),
                ema50: calculateEMA(closes, 50),
                ema200: calculateEMA(closes, 200),
                bb: calculateBollingerBands(closes, 20, 2),
                stochRSI: calculateStochasticRSI(closes, 14),
                adx: calculateADX(highs, lows, closes, 14),
                obv: calculateOBV(closes, volumes),
                williamsR: calculateWilliamsR(highs, lows, closes, 14),
                cci: calculateCCI(highs, lows, closes, 20)
            };
        }

        // Indicator calculation functions (RSI, MACD, EMA, etc.)
        function calculateRSI(prices, period = 14) {
            const rsi = new Array(prices.length).fill(50);
            for (let i = period; i < prices.length; i++) {
                let gains = 0, losses = 0;
                for (let j = i - period + 1; j <= i; j++) {
                    const change = prices[j] - prices[j - 1];
                    if (change > 0) gains += change;
                    else losses += Math.abs(change);
                }
                const avgGain = gains / period;
                const avgLoss = losses / period;
                if (avgLoss === 0) rsi[i] = 100;
                else rsi[i] = 100 - (100 / (1 + (avgGain / avgLoss)));
            }
            return rsi;
        }

        function calculateMACD(prices) {
            const ema12 = calculateEMA(prices, 12);
            const ema26 = calculateEMA(prices, 26);
            const macd = ema12.map((v, i) => v - ema26[i]);
            const signal = calculateEMA(macd, 9);
            const histogram = macd.map((v, i) => v - signal[i]);
            return { macd, signal, histogram };
        }

        function calculateEMA(prices, period) {
            const ema = new Array(prices.length);
            ema[0] = prices[0];
            const k = 2 / (period + 1);
            for (let i = 1; i < prices.length; i++) {
                ema[i] = prices[i] * k + ema[i - 1] * (1 - k);
            }
            return ema;
        }

        function calculateBollingerBands(prices, period = 20, stdDev = 2) {
            const sma = new Array(prices.length);
            const upper = new Array(prices.length);
            const lower = new Array(prices.length);
            for (let i = period - 1; i < prices.length; i++) {
                const slice = prices.slice(i - period + 1, i + 1);
                const mean = slice.reduce((a, b) => a + b, 0) / period;
                const variance = slice.reduce((a, b) => a + Math.pow(b - mean, 2), 0) / period;
                const std = Math.sqrt(variance);
                sma[i] = mean;
                upper[i] = mean + stdDev * std;
                lower[i] = mean - stdDev * std;
            }
            return { sma, upper, lower };
        }

        function calculateStochasticRSI(prices, period = 14) {
            const rsi = calculateRSI(prices, period);
            const stochRSI = new Array(rsi.length);
            for (let i = period; i < rsi.length; i++) {
                const slice = rsi.slice(i - period + 1, i + 1);
                const min = Math.min(...slice);
                const max = Math.max(...slice);
                if (max === min) stochRSI[i] = 50;
                else stochRSI[i] = ((rsi[i] - min) / (max - min)) * 100;
            }
            return stochRSI;
        }

        function calculateADX(highs, lows, closes, period = 14) {
            const adx = new Array(closes.length).fill(25);
            for (let i = period; i < closes.length; i++) {
                let plusDM = 0, minusDM = 0;
                for (let j = i - period + 1; j < i; j++) {
                    const highDiff = highs[j] - highs[j - 1];
                    const lowDiff = lows[j - 1] - lows[j];
                    if (highDiff > lowDiff && highDiff > 0) plusDM += highDiff;
                    if (lowDiff > highDiff && lowDiff > 0) minusDM += lowDiff;
                }
                adx[i] = Math.min(100, ((plusDM + minusDM) / period) * 2);
            }
            return adx;
        }

        function calculateOBV(closes, volumes) {
            const obv = new Array(closes.length);
            obv[0] = volumes[0];
            for (let i = 1; i < closes.length; i++) {
                if (closes[i] > closes[i - 1]) obv[i] = obv[i - 1] + volumes[i];
                else if (closes[i] < closes[i - 1]) obv[i] = obv[i - 1] - volumes[i];
                else obv[i] = obv[i - 1];
            }
            return obv;
        }

        function calculateWilliamsR(highs, lows, closes, period = 14) {
            const williamsR = new Array(closes.length);
            for (let i = period - 1; i < closes.length; i++) {
                const highestHigh = Math.max(...highs.slice(i - period + 1, i + 1));
                const lowestLow = Math.min(...lows.slice(i - period + 1, i + 1));
                williamsR[i] = ((highestHigh - closes[i]) / (highestHigh - lowestLow)) * -100;
            }
            return williamsR;
        }

        function calculateCCI(highs, lows, closes, period = 20) {
            const cci = new Array(closes.length);
            const tp = highs.map((h, i) => (h + lows[i] + closes[i]) / 3);
            for (let i = period - 1; i < closes.length; i++) {
                const slice = tp.slice(i - period + 1, i + 1);
                const sma = slice.reduce((a, b) => a + b, 0) / period;
                const md = slice.reduce((a, b) => a + Math.abs(b - sma), 0) / period;
                cci[i] = (tp[i] - sma) / (0.015 * md);
            }
            return cci;
        }

        // BACKTEST
        async function runBacktest() {
            state.trades = [];
            state.equity = [];
            state.buySignals = [];
            state.sellSignals = [];
            let capital = state.capital;
            let position = null;
            let peakCapital = capital;
            let maxDrawdown = 0;
            
            document.getElementById('progressSection').style.display = 'block';
            document.getElementById('backtestBtn').disabled = true;
            
            addLog('system', 'üöÄ START', `Backtest avec ${state.selectedBuyIndicators.length} BUY et ${state.selectedSellIndicators.length} SELL indicators`);
            
            const minPeriod = 200;
            
            for (let i = minPeriod; i < state.data.length; i++) {
                const current = state.data[i];
                
                // Update progress
                const progress = ((i - minPeriod) / (state.data.length - minPeriod)) * 100;
                document.getElementById('progressBar').style.width = progress.toFixed(1) + '%';
                document.getElementById('progressPercent').textContent = progress.toFixed(1) + '%';
                document.getElementById('currentDay').textContent = `${i - minPeriod + 1} / ${state.data.length - minPeriod}`;
                document.getElementById('currentDate').textContent = new Date(current.timestamp).toLocaleDateString('fr-FR');
                document.getElementById('currentPrice').textContent = '$' + current.close.toFixed(2);
                document.getElementById('totalTrades').textContent = state.trades.length;
                
                // Check BUY signal
                if (!position && checkBuySignal(i)) {
                    const tradeAmount = capital * 0.3;
                    const fees = tradeAmount * 0.001;
                    const totalCost = tradeAmount + fees;
                    
                    if (totalCost <= capital) {
                        const tokensAmount = tradeAmount / current.close;
                        position = {
                            entryPrice: current.close,
                            entryTime: current.timestamp,
                            entryIndex: i,
                            amount: tradeAmount,
                            tokensAmount: tokensAmount,
                            peak: current.close
                        };
                        capital -= totalCost;
                        state.buySignals.push({ index: i, price: current.close });
                        addLog('BUY', 'üü¢ ACHAT', `${tokensAmount.toFixed(6)} @ $${current.close.toFixed(2)}`);
                    }
                }
                
                // Check SELL signal
                if (position && checkSellSignal(i, position, current)) {
                    const sellValue = position.tokensAmount * current.close;
                    const fees = sellValue * 0.001;
                    const netValue = sellValue - fees;
                    const profit = netValue - position.amount;
                    const profitPercent = (profit / position.amount) * 100;
                    
                    capital += netValue;
                    state.trades.push({
                        entry: position.entryPrice,
                        exit: current.close,
                        profit: profit,
                        profitPercent: profitPercent,
                        entryIndex: position.entryIndex,
                        exitIndex: i
                    });
                    
                    state.sellSignals.push({ index: i, price: current.close });
                    addLog('SELL', profit >= 0 ? 'üü¢ VENTE' : 'üî¥ VENTE', 
                        `P/L: ${profit >= 0 ? '+' : ''}$${profit.toFixed(2)} (${profitPercent >= 0 ? '+' : ''}${profitPercent.toFixed(2)}%)`);
                    
                    position = null;
                }
                
                // Update peak
                if (position && current.close > position.peak) {
                    position.peak = current.close;
                }
                
                // Track equity
                let currentEquity = capital;
                if (position) {
                    currentEquity += position.tokensAmount * current.close;
                }
                state.equity.push({ time: current.timestamp, value: currentEquity });
                
                // Track drawdown
                if (currentEquity > peakCapital) peakCapital = currentEquity;
                const drawdown = ((peakCapital - currentEquity) / peakCapital) * 100;
                if (drawdown > maxDrawdown) maxDrawdown = drawdown;
                
                if (i % 10 === 0) await new Promise(r => setTimeout(r, 1));
            }
            
            // Close final position
            if (position) {
                const lastData = state.data[state.data.length - 1];
                const sellValue = position.tokensAmount * lastData.close;
                const fees = sellValue * 0.001;
                const netValue = sellValue - fees;
                const profit = netValue - position.amount;
                
                capital += netValue;
                state.trades.push({
                    entry: position.entryPrice,
                    exit: lastData.close,
                    profit: profit,
                    profitPercent: (profit / position.amount) * 100,
                    entryIndex: position.entryIndex,
                    exitIndex: state.data.length - 1
                });
                
                addLog('SELL', '‚èπÔ∏è FINAL', 'Position finale ferm√©e');
            }
            
            displayResults(capital, maxDrawdown);
            updateCharts();
            
            document.getElementById('backtestBtn').disabled = false;
            addLog('system', '‚úÖ TERMIN√â', `${state.trades.length} trades ‚Ä¢ ROI: ${(((capital - state.capital) / state.capital) * 100).toFixed(2)}%`);
        }

        function checkBuySignal(idx) {
            // ALL buy conditions must be true
            return state.selectedBuyIndicators.every(id => {
                const price = state.data[idx].close;
                const rsi = state.indicators.rsi[idx];
                const macd = state.indicators.macd.macd[idx];
                const macdSignal = state.indicators.macd.signal[idx];
                const macdPrev = state.indicators.macd.macd[idx - 1];
                const macdSignalPrev = state.indicators.macd.signal[idx - 1];
                const ema20 = state.indicators.ema20[idx];
                const ema50 = state.indicators.ema50[idx];
                const ema200 = state.indicators.ema200[idx];
                const stochRSI = state.indicators.stochRSI[idx];
                const bbLower = state.indicators.bb.lower[idx];
                const adx = state.indicators.adx[idx];
                const williamsR = state.indicators.williamsR[idx];
                const cci = state.indicators.cci[idx];
                const avgVolume = state.data.slice(Math.max(0, idx - 20), idx).reduce((sum, d) => sum + d.volume, 0) / 20;
                const currentVolume = state.data[idx].volume;
                const obv = state.indicators.obv[idx];
                const obvPrev = state.indicators.obv[idx - 1];
                
                switch(id) {
                    case 'rsi_oversold': return rsi < 30;
                    case 'rsi_35': return rsi < 35;
                    case 'rsi_40': return rsi < 40;
                    case 'stoch_rsi_low': return stochRSI < 20;
                    case 'macd_cross_up': return macd > macdSignal && macdPrev <= macdSignalPrev;
                    case 'macd_positive': return macd > 0;
                    case 'ema_20_50_cross': return ema20 > ema50;
                    case 'price_above_ema50': return price > ema50;
                    case 'price_above_ema200': return price > ema200;
                    case 'bb_lower': return price < bbLower * 1.02;
                    case 'bb_touch_lower': return price <= bbLower;
                    case 'adx_strong': return adx > 25;
                    case 'adx_moderate': return adx > 20;
                    case 'williams_oversold': return williamsR < -80;
                    case 'cci_oversold': return cci < -100;
                    case 'volume_high': return currentVolume > avgVolume;
                    case 'volume_surge': return currentVolume > avgVolume * 1.5;
                    case 'obv_rising': return obv > obvPrev;
                    default: return false;
                }
            });
        }

        function checkSellSignal(idx, position, current) {
            // At least ONE sell condition must be true
            return state.selectedSellIndicators.some(id => {
                const price = current.close;
                const profitPercent = ((price - position.entryPrice) / position.entryPrice) * 100;
                const trailingStop = ((position.peak - price) / position.peak) * 100;
                const rsi = state.indicators.rsi[idx];
                const macd = state.indicators.macd.macd[idx];
                const macdSignal = state.indicators.macd.signal[idx];
                const macdPrev = state.indicators.macd.macd[idx - 1];
                const macdSignalPrev = state.indicators.macd.signal[idx - 1];
                const ema20 = state.indicators.ema20[idx];
                const ema50 = state.indicators.ema50[idx];
                const stochRSI = state.indicators.stochRSI[idx];
                const bbUpper = state.indicators.bb.upper[idx];
                const williamsR = state.indicators.williamsR[idx];
                const cci = state.indicators.cci[idx];
                const avgVolume = state.data.slice(Math.max(0, idx - 20), idx).reduce((sum, d) => sum + d.volume, 0) / 20;
                const currentVolume = state.data[idx].volume;
                
                switch(id) {
                    case 'take_profit_2': return profitPercent >= 2;
                    case 'take_profit_3': return profitPercent >= 3;
                    case 'take_profit_5': return profitPercent >= 5;
                    case 'stop_loss_1': return profitPercent <= -1;
                    case 'stop_loss_2': return profitPercent <= -2;
                    case 'stop_loss_3': return profitPercent <= -3;
                    case 'trailing_stop': return trailingStop >= 1.5;
                    case 'rsi_overbought': return rsi > 70;
                    case 'rsi_75': return rsi > 75;
                    case 'stoch_rsi_high': return stochRSI > 80;
                    case 'macd_cross_down': return macd < macdSignal && macdPrev >= macdSignalPrev;
                    case 'macd_negative': return macd < 0;
                    case 'price_below_ema50': return price < ema50;
                    case 'price_below_ema20': return price < ema20;
                    case 'bb_upper': return price >= bbUpper;
                    case 'williams_overbought': return williamsR > -20;
                    case 'cci_overbought': return cci > 100;
                    case 'volume_low': return currentVolume < avgVolume * 0.5;
                    default: return false;
                }
            });
        }

        function displayResults(finalCapital, maxDrawdown) {
            const initialCapital = state.capital;
            const totalProfit = finalCapital - initialCapital;
            const roi = (totalProfit / initialCapital) * 100;
            
            const wins = state.trades.filter(t => t.profit > 0);
            const losses = state.trades.filter(t => t.profit <= 0);
            const winRate = state.trades.length > 0 ? (wins.length / state.trades.length) * 100 : 0;
            
            const avgWin = wins.length > 0 ? wins.reduce((sum, t) => sum + t.profit, 0) / wins.length : 0;
            const avgLoss = losses.length > 0 ? losses.reduce((sum, t) => sum + t.profit, 0) / losses.length : 0;
            
            const totalWins = wins.reduce((sum, t) => sum + t.profit, 0);
            const totalLosses = Math.abs(losses.reduce((sum, t) => sum + t.profit, 0));
            const profitFactor = totalLosses > 0 ? totalWins / totalLosses : totalWins > 0 ? 999 : 0;
            
            // Update UI
            const roiEl = document.getElementById('finalROI');
            roiEl.textContent = (roi >= 0 ? '+' : '') + roi.toFixed(2) + '%';
            roiEl.className = roi >= 0 ? 'text-4xl font-bold text-white' : 'text-4xl font-bold text-red-400';
            
            document.getElementById('initialCapital').textContent = '$' + initialCapital.toFixed(0);
            document.getElementById('finalCapital').textContent = '$' + finalCapital.toFixed(2);
            
            const profitEl = document.getElementById('totalProfit');
            profitEl.textContent = (totalProfit >= 0 ? '+$' : '-$') + Math.abs(totalProfit).toFixed(2);
            profitEl.className = totalProfit >= 0 ? 'text-xl font-bold text-green-400' : 'text-xl font-bold text-red-400';
            
            document.getElementById('numTrades').textContent = state.trades.length;
            document.getElementById('winRate').textContent = winRate.toFixed(1) + '%';
            document.getElementById('winTrades').textContent = wins.length;
            document.getElementById('loseTrades').textContent = losses.length;
            document.getElementById('avgWin').textContent = '+$' + avgWin.toFixed(2);
            document.getElementById('avgLoss').textContent = '$' + avgLoss.toFixed(2);
            document.getElementById('maxDrawdown').textContent = maxDrawdown.toFixed(2) + '%';
            document.getElementById('profitFactor').textContent = profitFactor.toFixed(2);
            
            document.getElementById('resultsSection').style.display = 'grid';
        }

        function updateCharts() {
            const step = Math.max(1, Math.floor(state.data.length / 200));
            const filtered = state.data.filter((_, i) => i % step === 0);
            
            // Price chart with buy/sell signals
            charts.price.data.labels = filtered.map(d => new Date(d.timestamp).toLocaleDateString('fr-FR'));
            charts.price.data.datasets[0].data = filtered.map(d => d.close);
            
            // Add buy signals
            const buyPoints = state.buySignals.map(s => ({
                x: Math.floor(s.index / step),
                y: s.price
            }));
            
            const sellPoints = state.sellSignals.map(s => ({
                x: Math.floor(s.index / step),
                y: s.price
            }));
            
            charts.price.data.datasets = [
                charts.price.data.datasets[0],
                {
                    label: 'Signaux ACHAT',
                    data: buyPoints,
                    borderColor: '#10b981',
                    backgroundColor: '#10b981',
                    pointRadius: 8,
                    pointStyle: 'triangle',
                    showLine: false,
                    pointRotation: 0
                },
                {
                    label: 'Signaux VENTE',
                    data: sellPoints,
                    borderColor: '#ef4444',
                    backgroundColor: '#ef4444',
                    pointRadius: 8,
                    pointStyle: 'triangle',
                    showLine: false,
                    pointRotation: 180
                }
            ];
            charts.price.update();
            
            // Update counts
            document.getElementById('buyPointsCount').textContent = state.buySignals.length;
            document.getElementById('sellPointsCount').textContent = state.sellSignals.length;
            document.getElementById('completedTrades').textContent = state.trades.length;
            
            // Equity chart
            const equityStep = Math.max(1, Math.floor(state.equity.length / 200));
            const equityFiltered = state.equity.filter((_, i) => i % equityStep === 0);
            charts.equity.data.labels = equityFiltered.map(e => new Date(e.time).toLocaleDateString('fr-FR'));
            charts.equity.data.datasets[0].data = equityFiltered.map(e => e.value);
            charts.equity.update();
            
            // RSI chart
            charts.rsi.data.labels = filtered.map(d => new Date(d.timestamp).toLocaleDateString('fr-FR'));
            charts.rsi.data.datasets[0].data = filtered.map((d, i) => state.indicators.rsi[i * step]);
            charts.rsi.update();
            
            // MACD chart
            charts.macd.data.labels = filtered.map(d => new Date(d.timestamp).toLocaleDateString('fr-FR'));
            charts.macd.data.datasets[0].data = filtered.map((d, i) => state.indicators.macd.histogram[i * step]);
            charts.macd.data.datasets[1].data = filtered.map((d, i) => state.indicators.macd.macd[i * step]);
            charts.macd.data.datasets[2].data = filtered.map((d, i) => state.indicators.macd.signal[i * step]);
            charts.macd.update();
            
            document.getElementById('chartsSection').style.display = 'block';
        }

        function addLog(source, action, details) {
            const timestamp = new Date().toLocaleTimeString();
            state.logs.unshift({ timestamp, source, action, details });
            if (state.logs.length > 100) state.logs.pop();
            if (state.logs.length % 5 === 0 || action.includes('‚úÖ') || action.includes('‚ùå')) {
                renderLogs();
            }
        }

        function renderLogs() {
            const icons = { BUY: 'üü¢', SELL: 'üî¥', system: '‚öôÔ∏è' };
            const display = state.logs.slice(0, 50);
            
            const html = display.map(log => `
                <div class="bg-gray-800 bg-opacity-50 border border-gray-700 rounded-lg p-3">
                    <div class="flex items-start gap-3">
                        <span class="text-2xl">${icons[log.source] || 'üìä'}</span>
                        <div class="flex-1">
                            <div class="flex items-center gap-2 mb-1">
                                <span class="font-bold text-white">${log.source}</span>
                                <span class="text-xs text-gray-500">${log.timestamp}</span>
                            </div>
                            <p class="text-sm font-semibold mb-1 text-gray-300">${log.action}</p>
                            <p class="text-xs text-gray-400">${log.details}</p>
                        </div>
                    </div>
                </div>
            `).join('');
            
            document.getElementById('tradeLogs').innerHTML = html || 
                '<div class="text-center text-gray-500 py-8">Aucun trade</div>';
        }

        function clearLogs() {
            if (confirm('Effacer les logs ?')) {
                state.logs = [];
                renderLogs();
            }
        }

        console.log('ü§ñ Custom Trading Bot Ready');
    </script>
</body>
</html>
